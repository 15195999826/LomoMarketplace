---
allowed-tools: Write, Read, Bash(mkdir:*), Bash(python:*), Glob
description: 初始化项目的 dev-helper 结构（架构 skill、命令、笔记目录）
---

## Your task

在当前项目中初始化 dev-helper 开发环境。

### 需要创建的结构

```
项目根目录/
├── .claude-plugin/
│   └── plugin.json         # 创建或合并
├── skills/
│   └── exploring-project/
│       ├── SKILL.md
│       └── references/
│           └── .gitkeep
├── commands/
│   ├── update-arch.md
│   ├── session-summary.md
│   └── whats-next.md
├── project-notes/
│   └── .gitkeep
└── CLAUDE.md               # 创建或追加
```

### 步骤

## 1. 检查并处理 .claude-plugin/plugin.json

使用 Glob 检查 `.claude-plugin/plugin.json` 是否存在：

**如果不存在**：创建新文件
```json
{
  "name": "project-local",
  "version": "0.1.0",
  "description": "项目本地插件 - 由 dev-helper 生成"
}
```

**如果已存在**：读取现有内容，保留原有配置，不覆盖。只需确保目录结构存在即可。

## 2. 创建目录结构

```bash
mkdir -p .claude-plugin
mkdir -p skills/exploring-project/references
mkdir -p commands
mkdir -p project-notes
```

## 3. 创建 skills/exploring-project/SKILL.md

根据 Skill 最佳实践规范：
- `name`: 使用 kebab-case，最多64字符
- `description`: 第三人称，说明做什么+何时触发，最多1024字符
- body: 简洁，指向 references/

```markdown
---
name: exploring-project
description: Provides project architecture overview including directory structure, module responsibilities, and tech stack. Activates when asking about project structure, modules, architecture, what this project does, directory layout, or code organization.
---

# Project Architecture

> Auto-generated by `/update-arch`. Do not edit manually.

## Overview

[项目名称和简介 - 由 /update-arch 填充]

## Directory Structure

[目录结构说明 - 由 /update-arch 填充]

## References

- [references/overview.md](references/overview.md) - 项目概览与技术栈
- [references/modules.md](references/modules.md) - 模块职责说明
```

## 4. 创建 skills/exploring-project/references/.gitkeep

（空文件，保持目录结构）

## 5. 创建 commands/update-arch.md

```markdown
---
allowed-tools: Read, Write, Glob, Bash(tree:*), Bash(dir:*)
description: 分析项目结构，更新架构文档
---

## Your task

分析当前项目结构，更新 `skills/exploring-project/` 下的文档。

## Skill 更新规范（基于最佳实践）

### 核心原则
- **简洁为王**：只写 Claude 不知道的信息
- **一层引用**：references 直接从 SKILL.md 引用，不要嵌套
- **不改 frontmatter**：name 和 description 已经设置好

### 文件结构
```
skills/exploring-project/
├── SKILL.md              # 概览（< 500 行）
└── references/
    ├── overview.md       # 项目概览、技术栈
    └── modules.md        # 模块职责
```

## 执行步骤

### 1. 收集项目信息
- `tree -L 2` 或 `dir /s /b` 获取目录结构
- 读取 package.json / Cargo.toml / pyproject.toml
- 读取 README.md
- 识别主要模块

### 2. 更新 references/overview.md
```markdown
# 项目概览

## 项目名称
[名称]

## 简介
[一句话描述]

## 技术栈
- 语言: [...]
- 框架: [...]
- 工具: [...]

## 目录结构
[简化的 tree 输出]

## 入口文件
- `src/index.ts` - [说明]
```

### 3. 更新 references/modules.md
```markdown
# 模块说明

## [模块名] (`路径/`)
**职责**: [一句话]
**关键文件**: [列表]
```

### 4. 更新 SKILL.md
只更新 Overview 和 Directory Structure 部分：
- Overview: 项目名 + 一句话简介
- Directory Structure: 简化目录树

### 5. 报告
```
✅ 架构文档已更新
- skills/exploring-project/SKILL.md
- skills/exploring-project/references/overview.md
- skills/exploring-project/references/modules.md
```
```

## 6. 创建 commands/session-summary.md

```markdown
---
allowed-tools: Write, Read, Glob
description: 总结当前对话，保存待办事项到 project-notes/
argument-hint: "[主题] 可选的笔记主题"
---

## Your task

总结当前对话内容，生成会话笔记。

### 步骤

1. **回顾对话内容**
   - 识别讨论的主要话题
   - 提取完成的任务
   - 识别待办事项和后续工作

2. **确定文件名**
   - 格式：`YYYY-MM-DD-主题.md`
   - 主题：使用用户提供的 $ARGUMENTS，或从对话中提炼
   - 日期：使用今天的日期

3. **生成笔记内容**
   ```markdown
   # [主题]

   日期：YYYY-MM-DD

   ## 完成的工作

   - [列出本次对话完成的任务]

   ## 待办事项

   - [ ] [列出需要后续处理的事项]

   ## 关键决策

   - [记录重要的设计或技术决策]

   ## 备注

   [其他需要记录的信息]
   ```

4. **保存到 project-notes/**
   使用 Write 工具保存文件

5. **报告保存位置**
   告知用户笔记已保存的路径
```

## 7. 创建 commands/whats-next.md

```markdown
---
allowed-tools: Read, Glob
description: 读取待办事项，给出工作建议
---

## Your task

帮助用户了解接下来应该做什么。

### 步骤

1. **读取 project-notes/ 目录**
   - 使用 Glob 找到所有 .md 文件
   - 按日期排序，重点关注最近的笔记

2. **提取待办事项**
   - 从笔记中找出所有 `- [ ]` 格式的待办
   - 识别标记为紧急或重要的事项

3. **检查 Git 状态**（可选）
   - 如有未提交的更改，提醒用户

4. **给出建议**
   - 列出待处理的事项
   - 按优先级排序
   - 给出建议的下一步行动

5. **询问用户**
   - 问用户想从哪个任务开始
```

## 8. 处理 CLAUDE.md

使用 Glob 检查 `CLAUDE.md` 是否存在：

**如果不存在**：创建新文件，包含完整内容

**如果已存在**：
1. 读取现有内容
2. 检查是否已包含 `## Dev Helper` 章节
3. 如果没有，在文件末尾追加以下内容

**CLAUDE.md 需要包含的内容**：

```markdown

## Dev Helper

本项目使用 dev-helper 进行项目管理。

### 可用命令

- `/update-arch` - 更新项目架构文档
- `/session-summary [主题]` - 总结当前对话
- `/whats-next` - 查看待办事项和工作建议

### 项目架构

启用 `skill:exploring-project`，当询问项目结构时自动激活。
```

## 9. 运行校验脚本

执行 dev-helper 插件中的校验脚本，验证初始化结果：

```bash
python ${CLAUDE_PLUGIN_ROOT}/scripts/validate_init.py .
```

如果校验失败，根据脚本输出的错误信息修复问题。

## 10. 完成报告

校验通过后，告知用户初始化完成：

```
✅ dev-helper 初始化完成！

创建的文件：
- .claude-plugin/plugin.json [新建/已存在]
- skills/exploring-project/SKILL.md
- skills/exploring-project/references/.gitkeep
- commands/update-arch.md
- commands/session-summary.md
- commands/whats-next.md
- project-notes/.gitkeep
- CLAUDE.md [新建/已追加]

校验结果：[显示脚本输出的通过项数]

下一步：
运行 `/update-arch` 生成项目架构文档
```
