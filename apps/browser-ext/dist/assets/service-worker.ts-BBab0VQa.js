chrome.action.onClicked.addListener(async e=>{e.id&&await chrome.sidePanel.open({tabId:e.id})});chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onMessage.addListener((e,c,r)=>{switch(console.log("[Service Worker] Received message:",e),e.type){case"GET_TAB_ID":return chrome.tabs.query({active:!0,currentWindow:!0},t=>{var o;r({tabId:(o=t[0])==null?void 0:o.id})}),!0;case"ATTACH_DEBUGGER":return a(e.tabId,r),!0;case"DETACH_DEBUGGER":return n(e.tabId,r),!0;case"SEND_CDP_COMMAND":return i(e.tabId,e.method,e.params,r),!0;default:r({error:"Unknown message type"})}});async function a(e,c){try{await chrome.debugger.attach({tabId:e},"1.3"),console.log(`[Service Worker] Debugger attached to tab ${e}`),c({success:!0})}catch(r){console.error("[Service Worker] Failed to attach debugger:",r),c({success:!1,error:r instanceof Error?r.message:String(r)})}}async function n(e,c){try{await chrome.debugger.detach({tabId:e}),console.log(`[Service Worker] Debugger detached from tab ${e}`),c({success:!0})}catch(r){console.error("[Service Worker] Failed to detach debugger:",r),c({success:!1,error:r instanceof Error?r.message:String(r)})}}async function i(e,c,r,t){try{const o=await chrome.debugger.sendCommand({tabId:e},c,r);t({success:!0,result:o})}catch(o){console.error(`[Service Worker] CDP command failed (${c}):`,o),t({success:!1,error:o instanceof Error?o.message:String(o)})}}chrome.debugger.onDetach.addListener((e,c)=>{console.log(`[Service Worker] Debugger detached from tab ${e.tabId}: ${c}`)});console.log("[Service Worker] Browser Control Extension loaded");
